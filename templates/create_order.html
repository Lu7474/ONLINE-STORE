{% extends 'base.html' %}
{% load carts_tags %}

{% block content %}
<div class="bg-white p-4 mb-4 mx-2 rounded custom-shadow">
  <div class="container">
    <h3 class="text-center mb-4">Выбранные товары</h3>
    <div class="container" id="cart-items-container">
      <!-- Разметка корзины -->
      {% user_carts request as carts %}

      <div class="col-md-7">
        <div class="bg-white p-4 mb-4 mx-2 rounded custom-shadow">
          <h3 class="text-center mb-4">Корзина</h3>
          <div class="container" id="cart-items-container">
            <!-- Разметка корзины -->
            <div class="card mb-3 text-bg-light shadow-lg">
              {% for cart in carts %}
                <div class="card-header">
                  <h5 class="card-title">{{ cart.product.name }}</h5>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">
                    <div class="row text-center">
                      <div class="col p-0">
                        <div class="input-group">
                          <span class="input-group-btn"><button type="button" class="btn btn-dark btn-sm decrement" data-cart-id="{{ cart.id }}" data-cart-change-url="{% url 'cart:cart_change' %}">{% csrf_token %}-</button></span>
                          <input type="text" class="form-control number" value="{{ cart.quantity }}" readonly />
                          <span class="input-group-btn"><button type="button" class="btn btn-dark btn-sm increment" data-cart-id="{{ cart.id }}" data-cart-change-url="{% url 'cart_change' %}">{% csrf_token %}+</button></span>
                        </div>
                      </div>
                      <div class="col p-0">
                        <p>x {{ cart.product.price }} =</p>
                      </div>
                      <div class="col p-0">
                        <strong>{{ cart.products_price }} $</strong>
                      </div>
                      <div class="col p-0">
                        <a href="{% url 'cart_remove' %}" class="remove-from-cart" data-cart-id="{{ cart.id }}">{% csrf_token %}Del</a>
                      </div>
                    </div>
                  </li>
                </ul>
              {% endfor %}
            </div>
            <div class="card mb-3 shadow-lg">
              <div class="card-footer">
                <p class="float-left">
                  Итого <strong>{{ carts.total_quantity }}</strong> товар(а) на сумму
                </p>
                <h4 class="float-left"><strong>{{ carts.total_price }} $</strong></h4>
              </div>
            </div>
            {% if carts and not order %}
              <a class="btn btn-dark" href="{% url 'create_order' %}">Оформить заказ</a>
            {% endif %}
            <!-- Закончилась разметка корзины -->
          </div>
        </div>
        <!-- Детали заказа -->
        <div class="container">
          <h3 class="text-center">Детали заказа</h3>
          <div class="card mb-3">
            <div class="card-body">
              <form action="{% url 'create_order' %}" method="post" id="create_order_form">
                {% csrf_token %}
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="id_first_name" class="form-label">Имя*:</label>
                    <input type="text" class="form-control" id="id_first_name" value="{% if form.first_name.value %}{{ form.first_name.value }}{% endif %}" name="first_name" required />
                    {% if form.first_name.errors %}
                      <div class="alert alert-danger alert-dismissible fade show">{{ form.first_name.errors }}</div>
                    {% endif %}
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="id_last_name" class="form-label">Фамилия*:</label>
                    <input type="text" class="form-control" id="id_last_name" name="last_name" value="{% if form.last_name.value %}{{ form.last_name.value }}{% endif %}" required />
                    {% if form.last_name.errors %}
                      <div class="alert alert-danger alert-dismissible fade show">{{ form.last_name.errors }}</div>
                    {% endif %}
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="id_phone_number" class="form-label">Номер телефона*:</label>
                    <input type="text" class="form-control" id="id_phone_number" name="phone_number" value="{% if form.phone_number.value %}{{ form.phone_number.value }}{% endif %}" placeholder="(000) 000-0000" required />
                    {% if form.phone_number.errors %}
                      <div class="alert alert-danger alert-dismissible fade show">{{ form.phone_number.errors }}</div>
                    {% endif %}
                    <div class="alert alert-danger alert-dismissible fade show" style="display: none" id="phone_number_error">Неверный формат номера</div>
                  </div>
                  <div class="col-md-12 mb-3">
                    <label for="delivery" class="form-label">Способ доставки:</label>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="requires_delivery" id="id_requires_delivery" value="1" checked />
                      <label class="form-check-label" for="id_requires_delivery">Нужна доставка</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="requires_delivery" id="id_requires_delivery" value="0" />
                      <label class="form-check-label" for="id_requires_delivery">Самовывоз</label>
                    </div>
                  </div>
                  <div class="mb-3" id="deliveryAddressField">
                    <label for="id_delivery_address" class="form-label">Адрес доставки*:</label>
                    <textarea class="form-control" id="id_delivery_address" value="{% if form.delivery_address.value %}{{ form.delivery_address.value }}{% endif %}" name="delivery_address" rows="2"></textarea>
                    {% if form.delivery_address.errors %}
                      <div class="alert alert-danger alert-dismissible fade show">{{ form.delivery_address.errors }}</div>
                    {% endif %}
                  </div>
                  <div class="col-md-12 mb-3">
                    <label class="form-label">Способ оплаты:</label>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="payment_on_get" id="id_payment_on_get" value="0" checked />
                      <label class="form-check-label" for="id_payment_on_get">Оплата картой</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="payment_on_get" id="id_payment_on_get" value="1" />
                      <label class="form-check-label" for="id_payment_on_get">Наличными/картой при плучении</label>
                      {% if form.payment_on_get.errors %}
                        <div class="alert alert-danger alert-dismissible fade show">{{ form.payment_on_get.errors }}</div>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <button type="submit" class="btn btn-dark">Оформить заказ</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      {% endblock %}
    </div>
  </div>
</div>
